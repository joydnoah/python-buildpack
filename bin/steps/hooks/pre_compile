#!/usr/bin/env bash

echo "Pre compile"

MY_REPO_GIT=git+https://${GITHUB_USER}:${GITHUB_PASSWORD}@github.com/OnMyRadarInc/events-connector-wrapper.git@20200825-first-configuration

export_env_dir() {
  env_dir=$1
  acceptlist_regex=${2:-''}
  denylist_regex=${3:-'^(PATH|GIT_DIR|CPATH|CPPATH|LD_PRELOAD|LIBRARY_PATH)$'}
  if [ -d "$env_dir" ]; then
    for e in $(ls $env_dir); do
      echo "$e" | grep -E "$acceptlist_regex" | grep -qvE "$denylist_regex" &&
      export "$e=$(cat $env_dir/$e)"
      :
    done
  fi
}

echo "${ENV_DIR}"
echo "${MY_REPO_GIT}"

if [ -f bin/pre_compile ]; then
    echo "-----> Running pre-compile hook"
    chmod +x bin/pre_compile
    sub_env bin/pre_compile
fi